Version 4
SHEET 1 1300 996
WIRE 208 -288 -160 -288
WIRE 416 -288 208 -288
WIRE 560 -288 416 -288
WIRE 208 -224 208 -288
WIRE -160 -208 -160 -288
WIRE 560 -208 560 -288
WIRE -1312 -144 -1376 -144
WIRE -1296 -144 -1312 -144
WIRE -976 -144 -1024 -144
WIRE -960 -144 -976 -144
WIRE -944 -144 -960 -144
WIRE -752 -144 -800 -144
WIRE -736 -144 -752 -144
WIRE -720 -144 -736 -144
WIRE -432 -144 -480 -144
WIRE -416 -144 -432 -144
WIRE -400 -144 -416 -144
WIRE -976 -112 -976 -144
WIRE -1376 -96 -1376 -144
WIRE -752 -96 -752 -144
WIRE -672 -96 -752 -96
WIRE 416 -96 416 -288
WIRE 208 -80 208 -144
WIRE 368 -80 208 -80
WIRE -432 -48 -432 -144
WIRE 560 -48 560 -128
WIRE -624 0 -960 0
WIRE -1376 16 -1376 -16
WIRE -624 48 -624 0
WIRE -752 96 -752 -96
WIRE 208 128 208 -80
WIRE -2112 160 -2240 160
WIRE -2032 160 -2112 160
WIRE -1808 160 -1968 160
WIRE -1600 160 -1808 160
WIRE -1408 160 -1520 160
WIRE -1360 160 -1408 160
WIRE -960 160 -960 0
WIRE -960 160 -1280 160
WIRE -944 160 -960 160
WIRE -832 160 -864 160
WIRE -624 176 -624 128
WIRE -624 176 -672 176
WIRE -496 176 -624 176
WIRE -432 176 -432 32
WIRE -432 176 -496 176
WIRE -160 176 -160 -128
WIRE -16 176 -160 176
WIRE 144 176 64 176
WIRE -976 192 -976 -32
WIRE -832 192 -976 192
WIRE -2240 208 -2240 160
WIRE -432 224 -432 176
WIRE -336 224 -432 224
WIRE -224 224 -256 224
WIRE 416 224 416 0
WIRE -1408 240 -1408 160
WIRE 208 272 208 224
WIRE -2240 320 -2240 288
WIRE -976 384 -976 272
WIRE -752 384 -752 256
WIRE -752 384 -976 384
WIRE -1408 400 -1408 320
WIRE -160 400 -160 272
WIRE 208 400 208 352
WIRE -752 464 -752 384
WIRE -1808 496 -1808 160
WIRE -1712 496 -1808 496
WIRE 416 496 416 288
WIRE 416 496 -1648 496
WIRE 416 656 416 496
WIRE -432 736 -432 656
WIRE -432 848 -432 816
FLAG 208 400 0
FLAG 560 -48 0
FLAG -752 464 0
FLAG -496 176 output
FLAG -160 400 0
FLAG -1376 16 0
FLAG -1408 400 0
FLAG -2240 320 0
FLAG -2112 160 input
IOPIN -2112 160 In
FLAG 416 656 out
IOPIN 416 656 Out
FLAG -1312 -144 V5V
FLAG -960 -144 V5V
FLAG -736 -144 V5V
FLAG -416 -144 V5V
FLAG -432 848 0
FLAG -672 -32 0
SYMBOL npn 144 128 R0
SYMATTR InstName Q1
SYMATTR Value BC846B
SYMBOL res 192 -240 R0
SYMATTR InstName R2
SYMATTR Value {mc(2k,tol_r)}
SYMBOL schottky 400 224 R0
SYMATTR InstName D_HVHV
SYMATTR Value MBR20100CT
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage 560 -224 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 30
SYMBOL LMV331 -768 176 R0
SYMATTR InstName U1
SYMBOL res -448 -64 R0
SYMATTR InstName R5
SYMATTR Value {mc(2k,tol_r)}
SYMBOL res -992 -128 R0
SYMATTR InstName R6
SYMATTR Value {mc(39k,tol_r)}
SYMBOL res -992 176 R0
SYMATTR InstName R7
SYMATTR Value {mc(10k,tol_r)}
SYMBOL voltage -2240 192 R0
WINDOW 3 24 96 Invisible 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PWL(0 16 1m 16 2m 6 3m 6 4m 16 5m 16)
SYMATTR InstName Vin
SYMBOL res -640 32 R0
SYMATTR InstName R8
SYMATTR Value {mc(60.4k,tol_r)}
SYMBOL res -1264 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value {mc(1.8k,tol_r)}
SYMBOL res -1504 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value {mc(20k,tol_r)}
SYMBOL res -1392 336 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R11
SYMATTR Value {mc(2k,tol_r)}
SYMBOL res 224 368 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R4
SYMATTR Value {mc(1k,tol_r)}
SYMBOL npn -224 176 R0
SYMATTR InstName Q2
SYMATTR Value BC846B
SYMBOL res -240 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value {mc(10k,tol_r)}
SYMBOL res -176 -224 R0
SYMATTR InstName R14
SYMATTR Value {mc(10k,tol_r)}
SYMBOL pmos 368 0 M180
WINDOW 3 56 4 Left 2
SYMATTR InstName M2
SYMBOL res 80 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value {mc(10k,tol_r)}
SYMBOL voltage -1376 -112 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value 5
SYMBOL schottky -2032 144 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D_HVHV1
SYMATTR Value MBR20100CT
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL schottky -1712 480 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D_HVHV2
SYMATTR Value MBR20100CT
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage -432 720 R0
WINDOW 3 24 44 Left 2
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value PULSE(0 5 0 1n 1n 1m 2m 3)
SYMATTR InstName HV_Supply_Select
SYMBOL cap -688 -96 R0
SYMATTR InstName C1
SYMATTR Value {mc(100n,tol_c)}
SYMBOL voltage -848 160 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 -96 101 VTop 2
SYMATTR InstName V3
SYMATTR Value {-offset_lmv331+mc(offset_lmv331,1)}
TEXT -1888 728 Left 2 !.tran 0 5m 0 50n
TEXT -1888 768 Left 2 ;replacing R5 with a 1.8k resistor shifts the hysteresis about 2 Volts up
TEXT -120 112 Left 1 ;BC846BPDW1 --> dual transistors
TEXT -1872 848 Left 2 !.step param run 1 100 1
TEXT -1880 896 Left 2 !.options noopiter gminsteps=0 method=gear
TEXT -1880 936 Left 2 !.options gmin=1e-10 reltol=0.005 trtol=10
TEXT -1880 800 Left 2 !.param offset_lmv331=7m tol_r=0.01 tol_c=0.1
